<?xml version="1.0"?>
<robot name="my_robot" xmlns:xacro="http://www.ros.org/wiki/xacro">
<link name="world"/>

  <joint name="base_joint" type="fixed">
    <parent link="world"/>
    <child link="base_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <!-- ===================== -->
  <!-- SAFE INERTIAL MACRO -->
  <!-- ===================== -->
  <xacro:macro name="box_inertial" params="mass x y z">
    <inertial>
      <origin xyz="0 0 ${z/2}"/>
      <mass value="${mass}"/>
      <inertia
        ixx="${mass * (y*y + z*z) / 12}"
        iyy="${mass * (x*x + z*z) / 12}"
        izz="${mass * (x*x + y*y) / 12}"
        ixy="0.0"
        ixz="0.0"
        iyz="0.0"/>
    </inertial>
  </xacro:macro>

  <!-- ===================== -->
  <!-- BASE -->
  <!-- ===================== -->
  <link name="base_link">
    <xacro:box_inertial mass="5.0" x="0.4" y="0.4" z="0.1"/>

    <visual>
      <origin xyz="0 0 0.05"/>
      <geometry><box size="0.4 0.4 0.1"/></geometry>
      <material name="gray"><color rgba="0.6 0.6 0.6 1"/></material>
    </visual>

    <collision>
      <origin xyz="0 0 0.05"/>
      <geometry><box size="0.4 0.4 0.1"/></geometry>
    </collision>
  </link>

  <!-- ===================== -->
  <!-- LINKS -->
  <!-- ===================== -->

  <link name="shoulder_link">
    <xacro:box_inertial mass="2.0" x="0.1" y="0.1" z="0.1"/>
    <visual>
      <origin xyz="0 0 0.05"/>
      <geometry><cylinder radius="0.05" length="0.1"/></geometry>
      <material name="blue"><color rgba="0 0 1 1"/></material>
    </visual>
    <collision>
      <origin xyz="0 0 0.05"/>
      <geometry><cylinder radius="0.05" length="0.1"/></geometry>
    </collision>
  </link>

  <link name="arm_link">
    <xacro:box_inertial mass="1.5" x="0.08" y="0.08" z="0.25"/>
    <visual>
      <origin xyz="0 0 0.125"/>
      <geometry><cylinder radius="0.04" length="0.25"/></geometry>
      <material name="green"><color rgba="0 1 0 1"/></material>
    </visual>
    <collision>
      <origin xyz="0 0 0.125"/>
      <geometry><cylinder radius="0.04" length="0.25"/></geometry>
    </collision>
  </link>

  <link name="elbow_link">
    <xacro:box_inertial mass="1.2" x="0.08" y="0.08" z="0.2"/>
    <visual>
      <origin xyz="0 0 0.1"/>
      <geometry><cylinder radius="0.04" length="0.2"/></geometry>
      <material name="red"><color rgba="1 0 0 1"/></material>
    </visual>
    <collision>
      <origin xyz="0 0 0.1"/>
      <geometry><cylinder radius="0.04" length="0.2"/></geometry>
    </collision>
  </link>

  <link name="forearm_link">
    <xacro:box_inertial mass="1.0" x="0.06" y="0.06" z="0.18"/>
    <visual>
      <origin xyz="0 0 0.09"/>
      <geometry><cylinder radius="0.03" length="0.18"/></geometry>
      <material name="yellow"><color rgba="1 1 0 1"/></material>
    </visual>
    <collision>
      <origin xyz="0 0 0.09"/>
      <geometry><cylinder radius="0.03" length="0.18"/></geometry>
    </collision>
  </link>

  <link name="wrist_link">
    <xacro:box_inertial mass="0.8" x="0.05" y="0.05" z="0.12"/>
    <visual>
      <origin xyz="0 0 0.06"/>
      <geometry><cylinder radius="0.025" length="0.12"/></geometry>
      <material name="cyan"><color rgba="0 1 1 1"/></material>
    </visual>
    <collision>
      <origin xyz="0 0 0.06"/>
      <geometry><cylinder radius="0.025" length="0.12"/></geometry>
    </collision>
  </link>

  <link name="hand_link">
    <xacro:box_inertial mass="0.5" x="0.08" y="0.08" z="0.02"/>
    <visual>
      <origin xyz="0 0 0.01"/>
      <geometry><box size="0.08 0.08 0.02"/></geometry>
      <material name="white"><color rgba="1 1 1 1"/></material>
    </visual>
    <collision>
      <origin xyz="0 0 0.01"/>
      <geometry><box size="0.08 0.08 0.02"/></geometry>
    </collision>
  </link>

  <link name="tool_link">
    <xacro:box_inertial mass="0.2" x="0.02" y="0.02" z="0.05"/>
    <visual>
      <origin xyz="0 0 0.025"/>
      <geometry><box size="0.02 0.02 0.05"/></geometry>
      <material name="orange"><color rgba="1 0.5 0 1"/></material>
    </visual>
    <collision>
      <origin xyz="0 0 0.025"/>
      <geometry><box size="0.02 0.02 0.05"/></geometry>
    </collision>
  </link>

  <!-- ===================== -->
  <!-- JOINTS -->
  <!-- ===================== -->

  <joint name="joint1" type="revolute">
    <parent link="base_link"/>
    <child link="shoulder_link"/>
    <origin xyz="0 0 0.1"/>
    <axis xyz="0 0 1"/>
    <limit lower="-3.14" upper="3.14" effort="50" velocity="2"/>
  </joint>

  <joint name="joint2" type="revolute">
    <parent link="shoulder_link"/>
    <child link="arm_link"/>
    <origin xyz="0 0 0.1"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="50" velocity="2"/>
  </joint>

  <joint name="joint3" type="revolute">
    <parent link="arm_link"/>
    <child link="elbow_link"/>
    <origin xyz="0 0 0.25"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="40" velocity="2"/>
  </joint>

  <joint name="joint4" type="revolute">
    <parent link="elbow_link"/>
    <child link="forearm_link"/>
    <origin xyz="0 0 0.2"/>
    <axis xyz="1 0 0"/>
    <limit lower="-3.14" upper="3.14" effort="30" velocity="2"/>
  </joint>

  <joint name="joint5" type="revolute">
    <parent link="forearm_link"/>
    <child link="wrist_link"/>
    <origin xyz="0 0 0.18"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="20" velocity="2"/>
  </joint>

  <joint name="joint6" type="continuous">
    <parent link="wrist_link"/>
    <child link="hand_link"/>
    <origin xyz="0 0 0.12"/>
    <axis xyz="0 0 1"/>
  </joint>

  <joint name="hand_tool_joint" type="fixed">
    <parent link="hand_link"/>
    <child link="tool_link"/>
    <origin xyz="0 0 0.02"/>
  </joint>

  
  <!-- ===================== -->
<!-- GAZEBO MATERIAL FIX -->
<!-- ===================== -->

<gazebo reference="base_link">
  <material>Gazebo/Grey</material>
</gazebo>

<gazebo reference="shoulder_link">
  <material>Gazebo/Blue</material>
</gazebo>

<gazebo reference="arm_link">
  <material>Gazebo/Green</material>
</gazebo>

<gazebo reference="elbow_link">
  <material>Gazebo/Red</material>
</gazebo>

<gazebo reference="forearm_link">
  <material>Gazebo/Yellow</material>
</gazebo>

<gazebo reference="wrist_link">
  <material>Gazebo/Cyan</material>
</gazebo>

<gazebo reference="hand_link">
  <material>Gazebo/White</material>
</gazebo>

<gazebo reference="tool_link">
  <material>Gazebo/Orange</material>
</gazebo>


<ros2_control name="GazeboSystem" type="system">
    <hardware>
      <plugin>gazebo_ros2_control/GazeboSystem</plugin>
    </hardware>
    
    <joint name="joint1">
      <command_interface name="position"/>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
    </joint>
    <joint name="joint2">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
    <joint name="joint3">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
    <joint name="joint4">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
    <joint name="joint5">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
    <joint name="joint6">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
  </ros2_control>

  <gazebo>
    <plugin name="gazebo_ros2_control" filename="libgazebo_ros2_control.so">
      <parameters>$(find my_robot_moveit_config)/config/ros2_controllers.yaml</parameters>
    </plugin>
  </gazebo>

  <link name="camera_link">
    <visual>
      <geometry><box size="0.02 0.05 0.05"/></geometry>
      <material name="black"><color rgba="0 0 0 1"/></material>
    </visual>
    <xacro:box_inertial mass="0.1" x="0.02" y="0.05" z="0.05"/>
  </link>

  <joint name="camera_joint" type="fixed">
    <parent link="tool_link"/>
    <child link="camera_link"/>
    <origin xyz="0.02 0 0" rpy="0 0 0"/>
  </joint>

  <gazebo reference="camera_link">
    <sensor type="camera" name="camera1">
      <update_rate>30.0</update_rate>
      <camera name="head">
        <horizontal_fov>1.3962634</horizontal_fov>
        <image>
          <width>800</width>
          <height>600</height>
          <format>R8G8B8</format>
        </image>
        <clip>
          <near>0.02</near>
          <far>300</far>
        </clip>
      </camera>
      <plugin name="camera_controller" filename="libgazebo_ros_camera.so">
        <frame_name>camera_link</frame_name>
      </plugin>
    </sensor>
  </gazebo>


</robot>
